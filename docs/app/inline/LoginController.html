<!DOCTYPE html>

<html>
<head>
  <title>LoginController.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>LoginController.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>LoginController.js</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="logincontroller">LoginController</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Grab the starter.controllers angular module (so we can add to it)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/**
 * @module starter.controllers
 */</span>
angular.module(<span class="hljs-string">'starter.controllers'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Create the LoginController controller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/**
 * @class LoginController
 * @constructor
 */</span>
.controller(<span class="hljs-string">'LoginController'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, LoginService, $ionicPopup, $state, $ionicSideMenuDelegate</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>This function will be called every time that the login view
is displayed, so check for auser already logged in</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> localStorageHandler = <span class="hljs-keyword">new</span> LocalStorageUtil(<span class="hljs-built_in">window</span>);
    <span class="hljs-keyword">var</span> oldUsername = localStorageHandler.get(<span class="hljs-string">"username"</span>, <span class="hljs-string">""</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>If a user was logged in, skip the login screen and take them 
directly to the default view (report view)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(oldUsername !== <span class="hljs-string">""</span>)
    {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Re-enable sliding the left side-menu (it should have 
been disabled on a previous logout)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $ionicSideMenuDelegate.canDragContent(<span class="hljs-literal">true</span>);
        $state.go(<span class="hljs-string">'tab.report'</span>);
    }

    $scope.data = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Checks the provided username and password and logs the user in
if the credentials are valid.  If invalid, notifies the user
and rejects the login attempt.  Utilizes LoginService to check 
credentials</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-comment">/**
     * @method login
     * @description Checks the provided username and password and logs the user in
     * if the credentials are valid.  If invalid, notifies the user
     * and rejects the login attempt
     * @return void
     * @throws none
     */</span>
    $scope.login = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        LoginService.loginUser($scope.data.username, $scope.data.password).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Save the username locally</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> storageHandler = <span class="hljs-keyword">new</span> LocalStorageUtil(<span class="hljs-built_in">window</span>);
            storageHandler.set(<span class="hljs-string">"username"</span>, $scope.data.username);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Move the user to the default view (tab.report)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $state.go(<span class="hljs-string">'tab.report'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Re-enable the ability to drag the side menu out (disabled on 
previous logouts)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $ionicSideMenuDelegate.canDragContent(<span class="hljs-literal">true</span>);
        }).error(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Notify the user of the failed login and do not login</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $ionicPopup.alert({
                title: <span class="hljs-string">'Login failed!'</span>,
                template: <span class="hljs-string">'Please check your credentials!'</span>
            });
        });
    };
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
