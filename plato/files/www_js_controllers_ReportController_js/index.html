<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - www/js/controllers/ReportController.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>www/js/controllers/ReportController.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">65.72</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">1269</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">60.02</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">11.01</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">// ReportController.js

/**
 * @module ace.controllers
 */
angular.module(&#039;ace.controllers&#039;)

// ReportController
//--------------------------------------------------------------

// Controller for the Report view.  This controller contains all the
// UI functionality for entering and saving reports
/**
 * @class ReportController
 * @description Controller for the Report view.  This controller contains all the
 * UI functionality for entering and saving reports.
 */
.controller(&#039;ReportController&#039;, function($scope, $state, $translate, $ionicNavBarDelegate, $ionicSideMenuDelegate, $ionicModal, UploadService, SettingsService, $ionicPopover, $ionicLoading, DataShareService, DbService, GeoService) {
  
  // Declare and initialize modal handler object
  $scope.modalHandler = new ModalHandler();
  
  // Adding enter event listener.  This function will be called just before every view load,
    // regardless of controller and state caching.  Here, this is used to enable the side menu drag functionality.
    $scope.$on(&#039;$ionicView.enter&#039;, function() {
    	$ionicSideMenuDelegate.canDragContent(true);
        
        // Re-translate the title (to ensure that it is correctly translated)
        $translate([&#039;WEATHER&#039;]).then(function(translations) {
           $ionicNavBarDelegate.title(translations.WEATHER); 
        });
    });
  
  // Check if sent here from template view
  $scope.$on(&#039;$ionicView.beforeEnter&#039;, function() {
    var template =  DataShareService.getItem(&quot;template&quot;, null);
    if(template)
    {
      $scope.importReport(template);
    }
    
    // Turn tracking back on (if necessary)
    var settings = SettingsService.getSettings(window);
    if(!GeoService.isTrackingEnabled() &amp;&amp; settings.gps.positionTrackingEnabled)
    {
        GeoService.enableTracking(settings.gps.trackingInterval);
    }
    
    // Turn auto-upload back on (10 second interval)
    UploadService.enableAutoUpload(10);
    
  });
  
  /**
   * Field holds the contents of the current report that is being entered
   * 
   * @property report
   * @type WeatherReport
   * @default All fields initialized to &quot;&quot;
   */
  $scope.report = new WeatherReport();

  // Submit Popover functions
  //-------------------------------------------------------------------------------------
  
  // Create popover from template and save to $scope variable
  $ionicPopover.fromTemplateUrl(&#039;templates/popovers/submit.html&#039;, {
    scope: $scope
  }).then(function(popover) {
    $scope.submitPopover = popover;
  });
  
  // Opens the submit popover.  Populates it with information from the current report ($scope.report)
  $scope.openPopover = function($event) {
    // Show the popover
    $scope.submitPopover.show($event);
    
    var translationsArray = [
        &#039;CLOUD_COVER&#039;,
        &#039;PRECIPITATION&#039;,
        &#039;VISIBILITY&#039;,
        &#039;PRESSURE_TENDENCY&#039;,
        &#039;SURFACE_PRESSURE&#039;,
        &#039;TEMPERATURE&#039;,
        &#039;WIND_SPEED&#039;,
        &#039;WIND_DIRECTION&#039;,
        &#039;OTHER&#039;,
        &#039;NOTES&#039;
    ];
    
    $translate(translationsArray).then(function(translations) {
        // Fill in each report element
        var clouds = document.getElementById(&quot;sumcat1&quot;);
        clouds.innerText = translations.CLOUD_COVER + &quot;: &quot; + $scope.report.cloudCover;
        
        var precip = document.getElementById(&quot;sumcat2&quot;);
        precip.innerText = translations.PRECIPITATION + &quot;: &quot; + $scope.report.precipitation;
        
        var vis = document.getElementById(&quot;sumcat3&quot;);
        vis.innerText = translations.VISIBILITY + &quot;: &quot; + $scope.report.visibility;
        
        var pressTrend = document.getElementById(&quot;sumcat4_1&quot;);
        pressTrend.innerText = translations.PRESSURE_TENDENCY + &quot;: &quot; + $scope.report.pressureTendency;
        
        var pressVal = document.getElementById(&quot;sumcat4_2&quot;);
        if($scope.report.pressureValue !== &quot;&quot;)
        {
            pressVal.innerText = translations.SURFACE_PRESSURE + &quot;: &quot; + $scope.report.pressureValue + &quot; hPa&quot;;
        }
        else
        {
            pressVal.innerText = translations.SURFACE_PRESSURE + &quot;: &quot;;   
        }
        
        
        var temp = document.getElementById(&quot;sumcat5&quot;);
        temp.innerText = translations.TEMPERATURE + &quot;: &quot; + $scope.report.temperatureValue + &quot; &quot; + $scope.report.temperatureUnits;
        
        var wind = document.getElementById(&quot;sumcat6&quot;);
        wind.innerText = translations.WIND_SPEED + &quot;: &quot; + $scope.report.windValue + &quot; &quot; + $scope.report.windUnits;
        
        var windDir = document.getElementById(&quot;sumcat6_3&quot;);
        windDir.innerText = translations.WIND_DIRECTION + &quot;: &quot; + $scope.report.windDirection;
        
        var other = document.getElementById(&quot;sumcat9&quot;);
        other.innerText = translations.OTHER + &quot;: &quot; + $scope.report.other;
        
        var notes = document.getElementById(&quot;sumcat7&quot;);
        notes.innerText = translations.NOTES + &quot;:\n&quot; + $scope.report.notes;
        
        var pic = document.getElementById(&quot;sumcat8&quot;);
    });
    
    
  };
  
  // Closes the submit popover
  $scope.closePopover = function() {
    $scope.submitPopover.hide();
  };
  
  // Called when the &quot;Send Report&quot; button on the submit popover is touched.  Should be used to 
  // execute a network call to submit the report.  Currently, just provides a fake success notification
  $scope.submitReport = function() {
    //$ionicLoading.show({template: &#039;Report Sent Successfully (un-implemented)&#039;, noBackdrop: true, duration: 1500});
    
    // Save report to database and upload
    var tempReport = $scope.report;
    GeoService.getCurrentPosition(navigator.geolocation, function(pos) {
        DbService.insertReportAndPosition(tempReport, pos, window, function(res) {
            // Manually upload report (an anything else)
            UploadService.uploadAll();
        });
    });
    
    // Clear all entered data
    $scope.report = new WeatherReport();    
    
    // Clear modal and summary data
    $scope.cloudCoverModal.clearData();
    $scope.precipModal.clearData();
    $scope.visibilityModal.clearData();
    $scope.pressureModal.clearData();
    $scope.surfaceTempModal.clearData();
    $scope.windModal.clearData();
    $scope.notesModal.clearData();
    $scope.otherModal.clearData();
    
    // Hide the popover
    $scope.submitPopover.hide();
  };
  
  // Function to import a report object (from template selection)
  //-------------------------------------------------------------------------------------
  $scope.importReport = function(report) {
    // Set report object
    $scope.report = report;
    
    // Update UI
    if(report.cloudCover &amp;&amp; report.cloudCover !== &quot;&quot;)
    {
      document.getElementById(&quot;cloud_sum&quot;).innerText = report.cloudCover;
      $scope.cloudCoverModal.selection = $scope.cloudCoverValueToId(report.cloudCover);
      $scope.cloudCoverModal.temp = $scope.cloudCoverValueToId(report.cloudCover);
    }
    
    if(report.precipitation &amp;&amp; report.precipitation !== &quot;&quot;)
    {
      document.getElementById(&quot;precip_sum&quot;).innerText = report.precipitation;
      $scope.precipModal.selection = $scope.precipitationValueToId(report.precipitation);
      $scope.precipModal.temp = $scope.precipitationValueToId(report.precipitation);
    }
    
    if(report.visibility &amp;&amp; report.visibility !== &quot;&quot;)
    {
      document.getElementById(&quot;vis_sum&quot;).innerText = report.visibility;
      $scope.visibilityModal.selection = $scope.visibilityValueToId(report.visibility);
      $scope.visibilityModal.temp = $scope.visibilityValueToId(report.visibility);
    }
    
    if(report.pressureValue &amp;&amp; report.pressureValue != &quot;&quot;)
    {
      document.getElementById(&quot;pressure_sum&quot;).innerText = report.pressureValue + &quot; hPa&quot;;
      $scope.pressureModal.input = report.pressureValue;
      $scope.pressureModal.inputTemp = report.pressureValue;
      
      $scope.pressureModal.selection = $scope.pressureValueToId(report.pressureTendency);
      $scope.pressureModal.temp = $scope.pressureValueToId(report.pressureTendency);
    }
    
    if(report.temperatureValue &amp;&amp; report.temperatureValue !== &quot;&quot;)
    {
      document.getElementById(&quot;temp_sum&quot;).innerText = report.temperatureValue + &quot; &quot; + report.temperatureUnits;
    }
    
    if(report.windValue &amp;&amp; report.windValue != &quot;&quot;)
    {
      document.getElementById(&quot;wind_sum&quot;).innerText = report.windValue + &quot; &quot; + report.windUnits + &quot; &quot; + report.windDirection;
    }
    
    if(report.notes &amp;&amp; report.notes != &quot;&quot;)
    {
      document.getElementById(&quot;notes_sum&quot;).innerText = report.notes;
    }
    
    if(report.other &amp;&amp; report.other != &quot;&quot;)
    {
      document.getElementById(&quot;other_sum&quot;).innerText = report.other;
    }    
  };
  
  // Function called when the application opens (every time)
  //-------------------------------------------------------------------------------------
  document.addEventListener(&quot;deviceready&quot;, onDeviceReady, false);
  
  function onDeviceReady() {
    // Open Db and create tables if necessary
    DbService.openDatabase(window);
    DbService.createTables(window);
    
    // Grab and set settings
    var localHandler = new LocalStorageUtil(window);
    var settings = localHandler.get(&quot;settings&quot;, null);
    if(settings === null)
    {
      settings = new Settings();
      localHandler.set(&quot;settings&quot;, settings);
    }
  };
  
  // Additional Options
  //--------------------------------------------------------------------------------------
  // Set up menu options popover
  // Create popover from template and save to $scope variable
  $ionicPopover.fromTemplateUrl(&#039;templates/popovers/report-options.html&#039;, {
    scope: $scope
  }).then(function(popover) {
    $scope.optionsPopover = popover;
  });
  
  $scope.openOptionsMenu = function($event) {
      $scope.optionsPopover.show($event);
  };
  
  // Additional options
  //--------------------------------------------------------------------------------------
  $scope.browseReportsClicked = function() {
    $scope.optionsPopover.hide();
    $state.go(&quot;browse-reports&quot;);
  };

  // Cloud Cover Modal Functions
  //--------------------------------------------------------------------------------------
  
  // Create cloudCoverModal from html
  $ionicModal.fromTemplateUrl(&#039;templates/modals/cloud_cover.html&#039;, {
      scope: $scope,
      animation: &#039;slide-in-up&#039;,
  }).then(function(modal) {
      $scope.cloudCoverModal = modal;
      $scope.cloudCoverModal.temp = &quot;&quot;;
      $scope.cloudCoverModal.selection = &quot;&quot;;  
      
      // Clear any Cloud Cover information 
      $scope.cloudCoverModal.clearData = function() {
        // Clear modal storage
        $scope.cloudCoverModal.temp = &quot;&quot;;
        $scope.cloudCoverModal.selection = &quot;&quot;;
        
        // Clear summary display
        document.getElementById(&quot;cloud_sum&quot;).innerText = &quot;______&quot;;    
      };    
  });
  
  
  
  // Select a cloud cover value
  $scope.selectItemCat1 = function(id) {
    var handler = $scope.modalHandler;
    handler.setNewTempSelection(document, $scope.cloudCoverModal, id);
  };
  
  // Save cloud cover selections
  $scope.saveModal1 = function() {
      $scope.modalHandler.saveModal(document, $scope.cloudCoverModal, &quot;cloud_sum&quot;, $scope.convertCategory1, function(str) {return str;});
      $scope.report.cloudCover = $scope.convertCategory1($scope.cloudCoverModal.selection);
  };
  
  // Cancel out of the cloud cover modal
  $scope.cancelModal1 = function() {
      $scope.cloudCoverModal.temp = &quot;&quot;;
      $scope.cloudCoverModal.hide();
  };

  // Open cloud cover modal
  $scope.openModal1 = function() {
      $scope.modalHandler.openModal(document, $scope.cloudCoverModal);
  };  

  $scope.cloudCoverValueToId = function(value) {
    var returnValue = &quot;&quot;;

    // Convert report value it item Id
    switch(value)
    {
      case &quot;No Clouds&quot;:
        returnValue = &quot;1opt1&quot;;
        break;
      case &quot;1/8th&quot;:
        returnValue = &quot;1opt2&quot;;
        break;
      case &quot;2/8ths&quot;:
        returnValue = &quot;1opt3&quot;;
        break;
      case &quot;3/8ths&quot;:
        returnValue = &quot;1opt4&quot;;
        break;
      case &quot;4/8ths&quot;:
        returnValue = &quot;1opt5&quot;;
        break;
      case &quot;5/8ths&quot;:
        returnValue = &quot;1opt6&quot;;
        break;
      case &quot;6/8ths&quot;:
        returnValue = &quot;1opt7&quot;;
        break;
      case &quot;7/8ths&quot;:
        returnValue = &quot;1opt8&quot;;
        break;
      case &quot;8/8ths&quot;:
        returnValue = &quot;1opt9&quot;;
        break; 
      case &quot;Sky Obscured&quot;:
        returnValue = &quot;1opt10&quot;;
        break;
      default:
        break;
    }
    
    return returnValue;
  };
  
  // Takes the id of the selected item on the cloud cover modal and returns the actual report value
  $scope.convertCategory1 = function(id) {
    
	var returnValue = &quot;&quot;;
    
    // Convert item id to actual report value
    switch(id)
    {
      case &quot;1opt1&quot;:
        returnValue = &quot;No Clouds&quot;;
        break;
      case &quot;1opt2&quot;:
        returnValue = &quot;1/8th&quot;;
        break;
      case &quot;1opt3&quot;:
        returnValue = &quot;2/8ths&quot;;
        break;
      case &quot;1opt4&quot;:
        returnValue = &quot;3/8ths&quot;;
        break;
      case &quot;1opt5&quot;:
        returnValue = &quot;4/8ths&quot;;
        break;
      case &quot;1opt6&quot;:
        returnValue = &quot;5/8ths&quot;;
        break;
      case &quot;1opt7&quot;:
        returnValue = &quot;6/8ths&quot;;
        break;
      case &quot;1opt8&quot;:
        returnValue = &quot;7/8ths&quot;;
        break;
      case &quot;1opt9&quot;:
        returnValue = &quot;8/8ths&quot;;
        break; 
      case &quot;1opt10&quot;:
        returnValue = &quot;Sky Obscured&quot;;
        break;
      default:
        break;
    }
    
    return returnValue;
  };

  
  // Precipitation Modal Functions
  //-----------------------------------------------------------------------------------------------
  
  // Create precipitation modal from html
  $ionicModal.fromTemplateUrl(&#039;templates/modals/precip_modal.html&#039;, {
      scope: $scope,
      animation: &#039;slide-in-up&#039;,
  }).then(function(modal) {
      // Save the modal and initialize the selection and temp variables
      $scope.precipModal = modal;
      
      // Used to save the actual selection made by the user
      $scope.precipModal.selection = &quot;&quot;; 
      
      // Used to store any temporary selections made with the modal open
      $scope.precipModal.temp = &quot;&quot;;     
      
      // Clear any precip data from modal storage
      $scope.precipModal.clearData = function() {
        // Clear modal storage
        $scope.precipModal.selection = &quot;&quot;;
        $scope.precipModal.temp = &quot;&quot;;
        
        // Clear summary
        document.getElementById(&quot;precip_sum&quot;).innerText = &quot;______&quot;;    
      };
  });
  
  
  
  // Select a precipitation value.  Called when an item on the precipitation modal is selected
  $scope.selectItemCat2 = function(id) {
    var handler = $scope.modalHandler;
    handler.setNewTempSelection(document, $scope.precipModal, id);
  };
  
  // Save precipitation modal selections.  Called when the save button on the precip modal is selected.
  $scope.saveModal2 = function() {
      $scope.modalHandler.saveModal(document, $scope.precipModal, &quot;precip_sum&quot;, $scope.convertCategory2, function(str) {return str;});
      $scope.report.precipitation = $scope.convertCategory2($scope.precipModal.selection);
  };
  
  // Cancel out of the precipitation modal.  Called when the cancel button on the precip modal is selected.
  $scope.cancelModal2 = function() {
      $scope.precipModal.temp = &quot;&quot;;
      $scope.precipModal.hide();
  };

  // Open the precipitation modal
  $scope.openModal2 = function() {
      $scope.modalHandler.openModal(document, $scope.precipModal);
  };  
  
  $scope.precipitationValueToId = function(value) {
        var returnValue = &quot;&quot;;
        switch(value)
        {
          case &quot;Light Rain&quot;:
            returnValue = &quot;2opt1&quot;;
            break;
          case &quot;Moderate Rain&quot;:
            returnValue = &quot;2opt2&quot;;
            break;
          case &quot;Heavy Rain&quot;:
            returnValue = &quot;2opt3&quot;;
            break;
          case &quot;Light Snow&quot;:
            returnValue = &quot;2opt4&quot;;
            break;
          case &quot;Moderate Snow&quot;:
            returnValue = &quot;2opt5&quot;;
            break;
          case &quot;Heavy Snow&quot;:
            returnValue = &quot;2opt6&quot;;
            break;
          case &quot;Freezing Rain&quot;:
            returnValue = &quot;2opt7&quot;;
            break;
          case &quot;Heavy Freezing Rain&quot;:
            returnValue = &quot;2opt8&quot;;
            break;
          case &quot;Raing &amp; Snow&quot;:
            returnValue = &quot;2opt9&quot;;
            break; 
          case &quot;Heavy Rain &amp; Snow&quot;:
            returnValue = &quot;2opt10&quot;;
            break;
          case &quot;Sleet&quot;:
            returnValue = &quot;2opt11&quot;;
            break;
          case &quot;Ice Needles&quot;:
            returnValue = &quot;2opt12&quot;;
            break;
          case &quot;Freezing Drizzle&quot;:
            returnValue = &quot;2opt13&quot;;
            break;
          case &quot;Thunderstorm&quot;:
            returnValue = &quot;2opt14&quot;;
            break;  
          case &quot;Thundersnow&quot;:
            returnValue = &quot;2opt15&quot;;
            break;
          case &quot;Virga&quot;:
            returnValue = &quot;2opt16&quot;;
            break;
          default:
            break;
    }
    
    return returnValue;
  };
  
  // Converts id for the precip modal to the actual report value
  $scope.convertCategory2 = function(opt) {
    var returnValue = &quot;&quot;;
    switch(opt)
    {
      case &quot;2opt1&quot;:
        returnValue = &quot;Light Rain&quot;;
        break;
      case &quot;2opt2&quot;:
        returnValue = &quot;Moderate Rain&quot;;
        break;
      case &quot;2opt3&quot;:
        returnValue = &quot;Heavy Rain&quot;;
        break;
      case &quot;2opt4&quot;:
        returnValue = &quot;Light Snow&quot;;
        break;
      case &quot;2opt5&quot;:
        returnValue = &quot;Moderate Snow&quot;;
        break;
      case &quot;2opt6&quot;:
        returnValue = &quot;Heavy Snow&quot;;
        break;
      case &quot;2opt7&quot;:
        returnValue = &quot;Freezing Rain&quot;;
        break;
      case &quot;2opt8&quot;:
        returnValue = &quot;Heavy Freezing Rain&quot;;
        break;
      case &quot;2opt9&quot;:
        returnValue = &quot;Rain &amp; Snow&quot;;
        break; 
      case &quot;2opt10&quot;:
        returnValue = &quot;Heavy Rain &amp; Snow&quot;;
        break;
      case &quot;2opt11&quot;:
        returnValue = &quot;Sleet&quot;;
        break;
      case &quot;2opt12&quot;:
        returnValue = &quot;Ice Needles&quot;;
        break;
      case &quot;2opt13&quot;:
        returnValue = &quot;Freezing Drizzle&quot;;
        break;
      case &quot;2opt14&quot;:
        returnValue = &quot;Thunderstorm&quot;;
        break;  
      case &quot;2opt15&quot;:
        returnValue = &quot;Thundersnow&quot;;
        break;
      case &quot;2opt16&quot;:
        returnValue = &quot;Virga&quot;;
        break;
      default:
        break;
    }
    
    return returnValue;
  };
  
  // Visibility Modal Functions
  //-----------------------------------------------------------------------------------------------

  // Create visibility modal from html
  $ionicModal.fromTemplateUrl(&#039;templates/modals/visibility_modal.html&#039;, {
      scope: $scope,
      animation: &#039;slide-in-up&#039;,
  }).then(function(modal) {
      // Save modal variable (for later acces)
      $scope.visibilityModal = modal;
      
      // Initialize selection variable.  Used to persist actual user selections
      $scope.visibilityModal.selection = &quot;&quot;;   
      
      // Initialize temp variable.  Used to temporarily store user selections while modal is open
      $scope.visibilityModal.temp = &quot;&quot;;  
      
      // Clear visibility data
      $scope.visibilityModal.clearData = function() {
        // Clear modal data
        $scope.visibilityModal.temp = &quot;&quot;;
        $scope.visibilityModal.selection = &quot;&quot;;
        
        // Clear summary
        document.getElementById(&quot;vis_sum&quot;).innerText = &quot;______&quot;;
      }; 
  });
  
  // Select an item on the visibility modal
  $scope.selectItemCat3 = function(id) {
    var handler = $scope.modalHandler;
    handler.setNewTempSelection(document, $scope.visibilityModal, id);
  };
  
  // Save visibility modal selections
  $scope.saveModal3 = function() {
      $scope.modalHandler.saveModal(document, $scope.visibilityModal, &quot;vis_sum&quot;, $scope.convertCategory3, function(str) {return str;});
      $scope.report.visibility = $scope.convertCategory3($scope.visibilityModal.selection);
  };
  
  // Cancel visibility modal
  $scope.cancelModal3 = function() {
      $scope.visibilityModal.temp = &quot;&quot;;
      $scope.visibilityModal.hide();
  };

  // Open visibility modal
  $scope.openModal3 = function() {
      $scope.modalHandler.openModal(document, $scope.visibilityModal);
  };  
  
  $scope.visibilityValueToId = function(value) {
    var returnValue = &quot;&quot;;
    switch(value)
    {
      case &quot;Mist&quot;:
        returnValue = &quot;3opt1&quot;;
        break;
      case &quot;Patchy Fog&quot;:
        returnValue = &quot;3opt2&quot;;
        break;
      case &quot;Fog&quot;:
        returnValue = &quot;3opt3&quot;;
        break;
      case &quot;Ice Fog&quot;:
        returnValue = &quot;3opt4&quot;;
        break;
      case &quot;Haze&quot;:
        returnValue = &quot;3opt5&quot;;
        break;
      case &quot;Blowing Snow&quot;:
        returnValue = &quot;3opt6&quot;;
        break;
      case &quot;Smoke&quot;:
        returnValue = &quot;3opt7&quot;;
        break;
      default:
        break;
    }
    
    return returnValue;  
  };
  
  // Conversion function for visibility.  Takes in the id of the user selection from the modal and returns the actual report value.
  $scope.convertCategory3 = function(opt) {
    var returnValue = &quot;&quot;;
    switch(opt)
    {
      case &quot;3opt1&quot;:
        returnValue = &quot;Mist&quot;;
        break;
      case &quot;3opt2&quot;:
        returnValue = &quot;Patchy Fog&quot;;
        break;
      case &quot;3opt3&quot;:
        returnValue = &quot;Fog&quot;;
        break;
      case &quot;3opt4&quot;:
        returnValue = &quot;Ice Fog&quot;;
        break;
      case &quot;3opt5&quot;:
        returnValue = &quot;Haze&quot;;
        break;
      case &quot;3opt6&quot;:
        returnValue = &quot;Blowing Snow&quot;;
        break;
      case &quot;3opt7&quot;:
        returnValue = &quot;Smoke&quot;;
        break;
      default:
        break;
    }
    
    return returnValue;
  };
  
  // Pressure Modal Functions
  //-----------------------------------------------------------------------------------------------------
  
  // Create pressure modal from html
  $ionicModal.fromTemplateUrl(&#039;templates/modals/pressure_modal.html&#039;, {
      scope: $scope,
      animation: &#039;slide-in-up&#039;,
  }).then(function(modal) {
      // Save modal variable
      $scope.pressureModal = modal;
      
      // Initialize selection and temp variables
      $scope.pressureModal.selection = &quot;&quot;;
      $scope.pressureModal.temp = &quot;&quot;;
      $scope.pressureModal.input = &quot;&quot;;
      $scope.pressureModal.inputTemp = &quot;&quot;;
      
      // Clear out any pressure data
      $scope.pressureModal.clearData = function() {
        // Clear modal storage
        $scope.pressureModal.selection = &quot;&quot;;
        $scope.pressureModal.temp = &quot;&quot;;
        $scope.pressureModal.input = &quot;&quot;;
        $scope.pressureModal.inputTemp = &quot;&quot;;
        
        // Clear summary
        document.getElementById(&quot;pressure_sum&quot;).innerText = &quot;______&quot;;
      };
  });
  
  // Open pressure modal
  $scope.openModal4 = function() {
    $scope.modalHandler.openModal(document, $scope.pressureModal);
    
    // Handle any previous pressure value (using angular data binding)
    if($scope.pressureModal.input &amp;&amp; $scope.pressureModal.input != &quot;&quot;)
    {
      $scope.pressureModal.inputTemp = $scope.pressureModal.input;
    }
  };
  
  // Select an item on pressure modal
  $scope.selectItemCat4 = function(id) {
    var handler = $scope.modalHandler;
    handler.setNewTempSelection(document, $scope.pressureModal, id);
  };
  
  // Cancel pressure modal
  $scope.cancelModal4 = function() {
      $scope.pressureModal.temp = &quot;&quot;;
      $scope.pressureModal.inputTemp = &quot;&quot;;
      $scope.pressureModal.hide();
  };
  
  // Save pressure modal selections
  $scope.saveModal4 = function() {
      $scope.modalHandler.saveModal(document, $scope.pressureModal, &quot;pressure_sum&quot;, $scope.convertCategory4, function(str) {return $scope.pressureModal.inputTemp + &quot; hPa&quot;;}, true);
      
      $scope.pressureModal.input = $scope.pressureModal.inputTemp;
      
      $scope.report.pressureTendency = $scope.convertCategory4($scope.pressureModal.selection);
      
      if($scope.pressureModal.input !== null)
      {
            $scope.report.pressureValue = $scope.pressureModal.input;      
            document.getElementById(&quot;pressure_sum&quot;).innerText = $scope.pressureModal.input + &quot; hPa&quot;;
      }
      else
      {
          $scope.report.pressureValue = &quot;&quot;;
          document.getElementById(&quot;pressure_sum&quot;).innerText = &quot;______&quot;;
      }
      
  };
  
  $scope.pressureValueToId = function(value) {
    var returnValue = &quot;&quot;;
    switch(value)
    {
      case &quot;Upward&quot;:
        returnValue = &quot;4opt1&quot;;
        break;
      case &quot;No Change&quot;:
        returnValue = &quot;4opt2&quot;;
        break;
      case &quot;Downward&quot;:
        returnValue = &quot;4opt3&quot;;
        break;
      default:
        break;
    }
    
    return returnValue;
  };
  
  // Conversion function for pressure modal.  Takes in the id of the user selection on the UI and returns the actual
  // report value
  $scope.convertCategory4 = function(opt) {
    var returnValue = &quot;&quot;;
    switch(opt)
    {
      case &quot;4opt1&quot;:
        returnValue = &quot;Upward&quot;;
        break;
      case &quot;4opt2&quot;:
        returnValue = &quot;No Change&quot;;
        break;
      case &quot;4opt3&quot;:
        returnValue = &quot;Downward&quot;;
        break;
      default:
        break;
    }
    
    return returnValue;
  };
  
  // Surface Temperature Modal Functions
  //-----------------------------------------------------------------------------------------------------
  
  // Create temperature modal from html
  $ionicModal.fromTemplateUrl(&#039;templates/modals/surf_temp_modal.html&#039;, {
      scope: $scope,
      animation: &#039;slide-in-up&#039;,
  }).then(function(modal) {
      // Save modal variable (for later access)
      $scope.surfaceTempModal = modal;
      
      // Initialize all input, select, and temp variables
      $scope.surfaceTempModal.input = &quot;&quot;;
      $scope.surfaceTempModal.inputTemp = &quot;&quot;;
      
      // For units
      $scope.surfaceTempModal.selectTemp = &quot;&quot;;
      $scope.surfaceTempModal.select = &quot;&quot;;
      
      // Clear out any temperature data
      $scope.surfaceTempModal.clearData = function() {
        // Clear modal storage
        $scope.surfaceTempModal.input = &quot;&quot;;
        $scope.surfaceTempModal.inputTemp = &quot;&quot;;
        $scope.surfaceTempModal.selectTemp = &quot;&quot;;
        $scope.surfaceTempModal.select = &quot;&quot;;
        
        // Clear summary
        document.getElementById(&quot;temp_sum&quot;).innerText = &quot;______&quot;;
      };
  });
  
  // Open temperature modal
  $scope.openModal5 = function() {
      
      // Select degrees C
      $scope.surfaceTempModal.selectTemp = &quot;C&quot;;
      
    $scope.modalHandler.openModal(document, $scope.surfaceTempModal);
    
    // Handle any previous temperature value
    if($scope.surfaceTempModal.input &amp;&amp; $scope.surfaceTempModal.input != &quot;&quot;)
    {
      $scope.surfaceTempModal.inputTemp = $scope.surfaceTempModal.input;
    }
    
    // Handle any previous temperature units selection
    if($scope.surfaceTempModal.select &amp;&amp; $scope.surfaceTempModal.select != &quot;&quot;)
    {
      $scope.surfaceTempModal.selectTemp = $scope.surfaceTempModal.select;
    }
    else 
    {
      document.getElementById(&quot;tempsel&quot;).selectedIndex = 1;
    }
  };
  
  // Cancel temperature modal
  $scope.cancelModal5 = function() {
      $scope.surfaceTempModal.inputTemp = &quot;&quot;;
      $scope.surfaceTempModal.selectTemp = &quot;&quot;;
      $scope.surfaceTempModal.hide();
  };
  
  // Save temperature modal selections
  $scope.saveModal5 = function() {
      
      // Save value
      $scope.surfaceTempModal.input = $scope.surfaceTempModal.inputTemp;
      $scope.surfaceTempModal.select = $scope.surfaceTempModal.selectTemp;
      
      // Save units
      $scope.report.temperatureValue = $scope.surfaceTempModal.input;
      if($scope.surfaceTempModal.select === &quot;C&quot;)
      {
          $scope.report.temperatureUnits = &quot; ÂºC &quot;;
      }
      else if($scope.surfaceTempModal.select === &quot;F&quot;)
      {
          $scope.report.temperatureUnits = &quot; ÂºF &quot;;
      }
      
      // Update the summary on the tab-report.html page
      document.getElementById(&#039;temp_sum&#039;).innerText = $scope.report.temperatureValue + &quot; &quot; + $scope.report.temperatureUnits;
      
      $scope.surfaceTempModal.hide();
  };
  
  
  // Wind modal Functions
  //-----------------------------------------------------------------------------------------------------
  
  // Create wind modal from html
  $ionicModal.fromTemplateUrl(&#039;templates/modals/wind_modal.html&#039;, {
      scope: $scope,
      animation: &#039;slide-in-up&#039;,
  }).then(function(modal) {
      $scope.windModal = modal;
      
      // Wind value variables
      $scope.windModal.input = &quot;&quot;;
      $scope.windModal.inputTemp = &quot;&quot;;
      
      // Wind units variables
      $scope.windModal.select1Temp = &quot;&quot;;
      $scope.windModal.select1 = &quot;&quot;;
      
      // Wind direction variables
      $scope.windModal.select2Temp = &quot;&quot;;
      $scope.windModal.select2 = &quot;&quot;;
      
      // Clear any wind data from modal storage
      $scope.windModal.clearData =  function() {
        // Clear modal storage
        $scope.windModal.input = &quot;&quot;;
        $scope.windModal.inputTemp = &quot;&quot;;
        $scope.windModal.select1Temp = &quot;&quot;;
        $scope.windModal.select1 = &quot;&quot;;
        $scope.windModal.select2Temp = &quot;&quot;;
        $scope.windModal.select2 = &quot;&quot;;
        
        // Clear summary
        document.getElementById(&quot;wind_sum&quot;).innerText = &quot;______&quot;;
      };
  
  });
  
  
  // Open wind modal
  $scope.openModal6 = function() {
      // Preselect knots and blank direction
      $scope.windModal.select1Temp = &quot;k&quot;;
      $scope.windModal.select2Temp = &quot;blank&quot;;
      
    // Open the modal
    $scope.modalHandler.openModal(document, $scope.windModal);
    
    // Handle any previous wind value entries (using angular data binding)
    if($scope.windModal.input &amp;&amp; $scope.windModal.input != &quot;&quot;)
    {
      $scope.windModal.inputTemp = $scope.windModal.input;
    }
    
    // Handle any previous wind units selections
    if($scope.windModal.select1 &amp;&amp; $scope.windModal.select1 != &quot;&quot;)
    {
      $scope.windModal.select1Temp = $scope.windModal.select1;
    }
    else
    {
      // Default to the 1st value (knots) selected
      document.getElementById(&quot;wind_sel_units&quot;).selectedIndex = 1;
    }
    
    // Handle any previous wind direction values
    if($scope.windModal.select2 &amp;&amp; $scope.windModal.select2 != &quot;&quot;)
    {
      $scope.windModal.select2Temp = $scope.windModal.select2;
    }
  };
  
  // Cancel wind modal
  $scope.cancelModal6 = function() {
      $scope.windModal.inputTemp = &quot;&quot;;
      $scope.windModal.select1Temp = &quot;&quot;;
       $scope.windModal.select2Temp = &quot;&quot;;
      $scope.windModal.hide();
  };
  
  // Save wind modal selections
  $scope.saveModal6 = function() {
      // Save wind speed value
      $scope.windModal.input = $scope.windModal.inputTemp;
      
      // Save wind units value
      $scope.windModal.select1 = $scope.windModal.select1Temp;
      
      // Save wind direction value
      $scope.windModal.select2 = $scope.windModal.select2Temp;
      
      // Load values into report
      if($scope.windModal.input === null)
      {
          $scope.report.windValue = &quot;&quot;;
          $scope.report.windUnits = &quot;&quot;;
      }
      else
      {
          $scope.report.windValue = $scope.windModal.input;
          if($scope.windModal.select1 === &quot;k&quot;)
          {
              $scope.report.windUnits = &quot; Knots &quot;;
          }
          else if($scope.windModal.select1 = &quot;m&quot;)
          {
              $scope.report.windUnits = &quot; mph &quot;;
          }
      }
      
      
      switch($scope.windModal.select2)
      {
            case &quot;blank&quot;:
                $scope.report.windDirection = &quot;&quot;;
                break;
            case &quot;north&quot;: 
                $scope.report.windDirection = &quot;North&quot;;
                break;
            case &quot;northeast&quot;:
                $scope.report.windDirection = &quot;Northeast&quot;;
                break;
            case &quot;east&quot;:
                $scope.report.windDirection = &quot;East&quot;;
                break;
            case &quot;southeast&quot;:
                $scope.report.windDirection = &quot;Southeast&quot;;
                break;
            case &quot;south&quot;:
                $scope.report.windDirection = &quot;South&quot;;
                break;
            case &quot;southwest&quot;:
                $scope.report.windDirection = &quot;Southwest&quot;;
                break;
            case &quot;west&quot;:
                $scope.report.windDirection = &quot;West&quot;;
                break;
            case &quot;northwest&quot;:
                $scope.report.windDirection = &quot;Northwest&quot;;
                break;
            default:
                $scope.report.windDirection = &quot;&quot;;
                break;
            
      }
      
      // Update the summary element on the tab-report.html view
      if($scope.report.windValue !== &quot;&quot;)
      {
          document.getElementById(&#039;wind_sum&#039;).innerText = $scope.report.windValue + &quot; &quot; + $scope.report.windUnits;
      }
      else
      {
          document.getElementById(&quot;wind_sum&quot;).innerText = &quot;______&quot;;
      }
      
      
      // close the modal
      $scope.windModal.hide();
  };
  
  
  
  // Notes Modal Functions
  //-----------------------------------------------------------------------------------------------------
  
  // Create Notes modal from html
  $ionicModal.fromTemplateUrl(&#039;templates/modals/notes_modal.html&#039;, {
      scope: $scope,
      animation: &#039;slide-in-up&#039;,
  }).then(function(modal) {
      $scope.notesModal = modal;
      $scope.notesModal.input = &quot;&quot;;
      $scope.notesModal.inputTemp = &quot;&quot;;
      
      // Clear any notes data from modal storage
      $scope.notesModal.clearData = function() {
        // Clear modal storage
        $scope.notesModal.input = &quot;&quot;;
        $scope.notesModal.inputTemp = &quot;&quot;;
        
        // Clear summary
        document.getElementById(&quot;notes_sum&quot;).innerText = &quot;______&quot;; 
      };
  
  });
  
  // Open notes modal
  $scope.openModal7 = function() {
    $scope.modalHandler.openModal(document, $scope.notesModal);
    
    if($scope.notesModal.input &amp;&amp; $scope.notesModal.input != &quot;&quot;)
    {
      $scope.notesModal.inputTemp = $scope.notesModal.input;
    }
    
  };
  
  // Cancel notes modal
  $scope.cancelModal7 = function() {
      $scope.notesModal.inputTemp = &quot;&quot;;
      $scope.notesModal.hide();
  };
  
  // Save notes modal selections
  $scope.saveModal7 = function() {
      // Save notes value
      $scope.notesModal.input = $scope.notesModal.inputTemp;
      
      // Load into report
      $scope.report.notes = $scope.notesModal.input;
      
      // Update summary on tab-report.html
      document.getElementById(&#039;notes_sum&#039;).innerText = $scope.report.notes;
      
      // close out the modal
      $scope.notesModal.hide();
  };
  
  // Camera Modal Functions
  //-----------------------------------------------------------------------------------------------------
  
  // Function called when the camera modal is selected on the 
  $scope.reportCategory8 = function() {
      $scope.openModal8();
  };
  
  // Create Camera modal from html
  $ionicModal.fromTemplateUrl(&#039;templates/modals/camera_modal.html&#039;, {
      scope: $scope,
      animation: &#039;slide-in-up&#039;,
  }).then(function(modal) {
      $scope.cameraModal = modal;
  });
  
  // Take a picture
  $scope.takePic = function() {
    navigator.device.capture.captureImage(function(mediaFiles) {
      var image = document.getElementById(&quot;modal9preview&quot;);
      image.src = mediaFiles[0].fullPath;
      alert(mediaFiles[0].name);
      
      }, function() {alert(&quot;error&quot;);}, {limit:1});
  };
  
  // Take a video
  $scope.takeVid = function() {
    navigator.device.capture.captureVideo(function() {alert(&quot;success&quot;);}, function() {alert(&quot;error&quot;);}, {limit:1});
  };
  
  // Select a picture from the file browser
  $scope.selectPic = function() {
    navigator.camera.getPicture(function() {alert(&quot;success&quot;);}, function() {alert(&quot;error&quot;);}, {quality: 50, destinationType: Camera.DestinationType.FILE_URI, sourceType: Camera.PictureSourceType.PHOTOLIBRARY})
  };
  
  // Open the camera modal
  $scope.openModal8 = function() {
      $scope.cameraModal.show();
  };
  
  // Close the camera modal
  $scope.closeModal8 = function() {
      $scope.cameraModal.hide();
  };
  
  // Function called when user presses cancel on modal8
  $scope.cancelModal8 = function() {
      this.closeModal8();
  };

  // Function called when user presses save on modal8
  $scope.saveModal8 = function() {
      this.closeModal8();
  };

  // Category 9 Functions
  //--------------------------------------------------------------------------------------
  
  // Function called when the category 9 option button is pressed
  $scope.reportCategory9 = function() {
      $scope.openModal9();
  };
  
  // Other Modal Functions
  //--------------------------------------------------------------------------------------
  
  // Create other modal (aurora borealis and tornado) from html
  $ionicModal.fromTemplateUrl(&#039;templates/modals/other_modal.html&#039;, {
      scope: $scope,
      animation: &#039;slide-in-up&#039;,
  }).then(function(modal) {
      // Save modal variable for later access
      $scope.otherModal = modal;
      
      // Initialize selection and temp variables
      $scope.otherModal.selection = &quot;&quot;;    
      $scope.otherModal.temp = &quot;&quot;;  
      
      // Clear out &quot;Other&quot; data from the modal
      $scope.otherModal.clearData = function() {
        // Clear modal storage
        $scope.otherModal.selection = &quot;&quot;;
        $scope.otherModal.temp = &quot;&quot;;
        
        // Clear summary
        document.getElementById(&quot;other_sum&quot;).innerText = &quot;______&quot;;
      };
  });
  
  // Select an item on the other modal
  $scope.selectItemCat9 = function(id) {
    var handler = $scope.modalHandler;
    handler.setNewTempSelection(document, $scope.otherModal, id);
  };
  
  // Save other modal selections
  $scope.saveModal9 = function() {
      $scope.modalHandler.saveModal(document, $scope.otherModal, &quot;other_sum&quot;, $scope.convertCategory9, function(str) {return str;});
      $scope.report.other = $scope.convertCategory9($scope.otherModal.selection);
  };
  
  // Cancel out of the other modal
  $scope.cancelModal9 = function() {
      // Reset any temporary selections and close the modal
      $scope.otherModal.temp = &quot;&quot;;
      $scope.otherModal.hide();
  };

  // Open the Other modal
  $scope.openModal9 = function() {
      $scope.modalHandler.openModal(document, $scope.otherModal);
  };  
  
  // Takes in an id string representing the item selected in the modal.  Returns the corresponding report string value.
  $scope.convertCategory9 = function(opt) {
    var returnValue = &quot;&quot;;
    switch(opt)
    {
      case &quot;9opt1&quot;:
        returnValue = &quot;Aurora Borealis&quot;;
        break;
      case &quot;9opt2&quot;:
        returnValue = &quot;Tornado&quot;;
        break;
      default:
        break;
    }
    
    return returnValue;
  };
  
  // onDestroy function for the ReportController.  This implemnetation will remove all modals.
  /**
   * @method onDestroy
   * @description Called when the controller is about to be destroyed.  Used here to release all modal resources.
   */
  $scope.$on(&#039;$destroy&#039;, function() {
      // Cleanup all modals
      $scope.cloudCoverModal.remove();
      $scope.precipModal.remove();
      $scope.visibilityModal.remove();
      $scope.pressureModal.remove();
      $scope.surfaceTempModal.remove();
      $scope.windModal.remove();
      $scope.notesModal.remove();
      $scope.cameraModal.remove();
      $scope.otherModal.remove();
      
      // Cleanup submit popover
      $scope.submitPopover.remove();
  });
});</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
